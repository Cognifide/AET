/*
 * This file was generated by the Gradle 'init' task.
 */

plugins {
    id 'com.cognifide.aet.java-conventions'
}

def packages = "${buildDir}/packages-${project.version}"

task zipBundles(type: Zip) {
    dependsOn rootProject.getTasksByName('build', true)
    archiveFileName = 'bundles.zip'
    destinationDirectory = file("$packages")
    includeEmptyDirs = false
    rootProject.subprojects { subproject ->
        from("${subproject.buildDir}/libs") {
            include "**/${subproject.name}*.jar"
            exclude "*aet-maven-plugin*.jar"
            exclude "*-test*.jar"
            exclude "*client*.jar"
            exclude "*sample-site*.jar"
            exclude "*zip*"
            rename { "${project.group}.${subproject.name}.jar" }
        }
    }
}

task zipConfigs(type: Zip) {
    destinationDirectory = file("$packages")
    archiveFileName = "configs.zip"
    from("${project(':configs').projectDir}/src/main/resources")
}

task zipFeatures(type: Zip) {
    destinationDirectory = file("$packages")
    archiveFileName = "features.zip"
    includeEmptyDirs = false
    from("${rootDir}/osgi-dependencies") {
        include "**/aet-features.xml"
        include "**/aet-webconsole.xml"
    }
}

task zipReport(type: Copy) {
    dependsOn project(":report").getTasksByName('build', true)
    from "${project(':report').buildDir}/distributions/report.zip"
    into "$packages"
}

task zipSampleSite(type: Zip) {
    dependsOn project(":sample-site").getTasksByName('build', true)
    destinationDirectory = file("$packages")
    archiveFileName = "sample-site.zip"
    from(project(":sample-site").buildDir) {
        include "**/*.war"
    }
}

task make {
    dependsOn tasks.zipBundles
    dependsOn tasks.zipConfigs
    dependsOn tasks.zipFeatures
    dependsOn tasks.zipReport
    dependsOn tasks.zipSampleSite
}

description = 'AET'
